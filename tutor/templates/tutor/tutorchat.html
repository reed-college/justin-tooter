{% extends "tutor/base.html" %}
{% load static %}
{% load i18n %}
{% load tutor_extras %}

{% block title%} 
    Tutoring Page
{% endblock %}

{% block content %}
    <div class="container">
        <h2>Tutoring page</h2>
        <p>
        If you receive a message from a student, you will be alerted here:
        </p>
        <table class="table table-hover">
            <tbody id="new-message-div">
                
            </tbody>
            <tbody id="old-message-div">
                {% for dialog in dialogs %}
                    {# this part figures out if the current user is the opponent, #}
                    {# or the owner of the dialog #}
                    {% with username=dialog|other_username:request.user.username %}
                        <tr id="{{username}}-element" class="clickable-row" data-href='{% url "dialogs_detail" username %}'>
                            <td><b>{{username}}</b></td>
                            <td>
                            {% with dialog|most_recent_message as message %}
                                {{ message.text }}
                            {% endwith %}
                            </td>
                        </tr>
                        {% endwith %}
                {% endfor %}
            </tbody>
        </table>
    </div>
    <div id="no-messages-template" class="hidden">
        <tr id="no-messages-element">
            No students have messaged you yet.
        </tr> 
    </div>
    <div id="new-message-template" class="hidden">
        <tr id="[username]-element">
            <td>[username]</td>
            {# this assumes that the url for dialog_detail will be the same as dialogs, but with a username on the end #}
            <td>
            <a href='{% url "dialogs" %}[username]' target="_blank">
                You can view the message and reply here.
            </a>
            </td>
        </tr>
    </div>
{% endblock %}

{% block extra_js %}
    <script>
        var base_ws_server_path = "{{ ws_server_path }}";
        var session_key = '{{ request.session.session_key }}'
    </script>
    <script src="{% static 'js/tutorchat.js' %}"
{% endblock %}
